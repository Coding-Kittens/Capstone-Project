{"ast":null,"code":"import _toConsumableArray from\"/Users/rosepowell/Desktop/Book_Writing/book_writing/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"/Users/rosepowell/Desktop/Book_Writing/book_writing/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/rosepowell/Desktop/Book_Writing/book_writing/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/rosepowell/Desktop/Book_Writing/book_writing/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import cover from'../sprites/OpenBook1.png';import page from'../sprites/OpenBookPages.png';import{useNavigate}from\"react-router-dom\";import{useState,useEffect,useContext}from'react';import InputPage from'./InputPage';import BookMark from'../books/BookMark';import{UserContext,MessageContext}from\"../context/context\";import Page from'./Page';import useAxios from'../hooks/useAxios';import'../css/Book.css';//keeps track of what page the user is on\n//\n// if they are reading the book gets all the pages for it\n//\n//  if not gets the page by page num when going to the next page\n//   add pages when there are no more Pages\n//   updates the pages when changeing pages and when user presses save\n///////////\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Book=function Book(_ref){var areReading=_ref.areReading,bookId=_ref.bookId,_ref$num_of_pages=_ref.num_of_pages,num_of_pages=_ref$num_of_pages===void 0?2:_ref$num_of_pages;var currentUser=useContext(UserContext);var _useContext=useContext(MessageContext),message=_useContext.message,setMessage=_useContext.setMessage;var navigate=useNavigate();var _useAxios=useAxios([],areReading),_useAxios2=_slicedToArray(_useAxios,3),reqPages=_useAxios2[0],pages=_useAxios2[1],setPages=_useAxios2[2];var _useAxios3=useAxios(null),_useAxios4=_slicedToArray(_useAxios3,2),reqBook=_useAxios4[0],book=_useAxios4[1];var _useState=useState([1,2]),_useState2=_slicedToArray(_useState,2),currPage=_useState2[0],setCurrPage=_useState2[1];//when the component first renders\n// gets all the pages in the book, if the user is reading the book\nuseEffect(function(){var getPages=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!areReading){_context.next=6;break;}_context.next=3;return reqPages('get',\"/books/\".concat(bookId,\"/pages/all\"),'pages');case 3:res=_context.sent;if(res.data.length<=0)navigate(\"/\");setMessage({text:'There are no pages in this book',color:'orange'});case 6:case\"end\":return _context.stop();}}},_callee);}));return function getPages(){return _ref2.apply(this,arguments);};}();getPages();},[]);///when the current page updates gets the current pages, if the user is writing\n//if there are no pages in the book then it adds pages, if the user is writing\n//if a user is trying to write on another users book, it redirects them to the page where they can read it instead\nuseEffect(function(){var getPages=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var res,_res;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return reqBook('get',\"/books/\".concat(bookId),'book');case 2:res=_context2.sent;if(!(!areReading&&res.data.username===currentUser.username)){_context2.next=10;break;}_context2.next=6;return reqPages('get',\"/books/\".concat(bookId,\"/pages\"),'pages',{page_nums:currPage},false);case 6:_res=_context2.sent;if(_res.message==='Page not found!'){addPages();}else{setPages(function(n){return n=_toConsumableArray(_res);});}_context2.next=11;break;case 10:if(!areReading&&res.data.username!==currentUser.username){navigate(\"/book/\".concat(bookId));//set message to: Unautrized! Only the writer of the book can edit the book.\n}case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function getPages(){return _ref3.apply(this,arguments);};}();getPages();},[currPage]);//go to the next or previous pages\n//save the current pages\nvar changePage=function changePage(num,data){if(!areReading)updatePage(data);var newPage=currPage[0]!==null?currPage[0]+num:num;if(newPage<=0)newPage=1;if(newPage>=pages.length&&areReading)newPage=pages.length-1;setCurrPage(function(n){return n=[newPage,newPage+1];});};//gose to a page\nvar goToPage=function goToPage(num){setCurrPage(function(n){return n=[num,num+1];});};//add new Pages\nvar addPages=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var res;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return reqPages('post',\"/books/\".concat(bookId,\"/pages\"),'pages',{num_of_pages:2,page_num:currPage[0]});case 2:res=_context3.sent;case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function addPages(){return _ref4.apply(this,arguments);};}();//saves/updates the current pages\nvar updatePage=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(data){var pg1,pg2;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!currPage[0]){_context4.next=7;break;}_context4.next=3;return reqPages('patch',\"/books/\".concat(bookId,\"/pages/\").concat(currPage[0]),'page',{text:data.text},false);case 3:pg1=_context4.sent;_context4.next=6;return reqPages('patch',\"/books/\".concat(bookId,\"/pages/\").concat(currPage[1]),'page',{text:data.text2},false);case 6:pg2=_context4.sent;case 7:case\"end\":return _context4.stop();}}},_callee4);}));return function updatePage(_x){return _ref5.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"Book\",children:[pages[0]&&!areReading?/*#__PURE__*/_jsx(BookMark,{bookId:bookId,username:currentUser.username,currPageId:pages[0].id,changePage:goToPage}):null,/*#__PURE__*/_jsx(\"img\",{className:areReading?'Book_cover_Reading':'Book_cover',src:cover,alt:\"cover\"}),/*#__PURE__*/_jsx(\"img\",{className:areReading?'Book_pages_Reading':'Book_pages',src:page,alt:\"pages\"}),pages.length>0?areReading?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Page,{changePage:changePage,page:[pages[currPage[0]-1],pages[currPage[1]-1]]})}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(InputPage,{changePage:changePage,savePage:updatePage,page:_toConsumableArray(pages)})}):null]});};export default Book;","map":{"version":3,"names":["cover","page","useNavigate","useState","useEffect","useContext","InputPage","BookMark","UserContext","MessageContext","Page","useAxios","Book","areReading","bookId","num_of_pages","currentUser","message","setMessage","navigate","reqPages","pages","setPages","reqBook","book","currPage","setCurrPage","getPages","res","data","length","text","color","username","page_nums","addPages","n","changePage","num","updatePage","newPage","goToPage","page_num","pg1","text2","pg2","id"],"sources":["/Users/rosepowell/Desktop/Book_Writing/book_writing/src/books/Book.js"],"sourcesContent":["import cover from '../sprites/OpenBook1.png';\nimport page from '../sprites/OpenBookPages.png';\nimport { useNavigate } from \"react-router-dom\";\nimport {useState, useEffect, useContext} from 'react';\nimport InputPage from './InputPage';\nimport  BookMark from '../books/BookMark';\nimport { UserContext, MessageContext } from \"../context/context\";\nimport Page from './Page';\n\nimport useAxios from '../hooks/useAxios';\nimport '../css/Book.css';\n\n//keeps track of what page the user is on\n//\n// if they are reading the book gets all the pages for it\n//\n//  if not gets the page by page num when going to the next page\n//   add pages when there are no more Pages\n//   updates the pages when changeing pages and when user presses save\n///////////\nconst Book =({areReading,bookId,num_of_pages=2})=>{\n\n  const currentUser = useContext(UserContext);\n  const {message,setMessage} = useContext(MessageContext);\n  const navigate = useNavigate();\nconst [reqPages,pages,setPages] = useAxios([],areReading);\nconst [reqBook,book] = useAxios(null);\nconst [currPage,setCurrPage]=useState([1,2]);\n\n//when the component first renders\n// gets all the pages in the book, if the user is reading the book\nuseEffect(()=>{\nconst getPages=async()=>{\n  if(areReading){\n      const res = await reqPages('get',`/books/${bookId}/pages/all`,'pages');\n      if(res.data.length <=0) navigate(`/`);\n      setMessage({text: 'There are no pages in this book',color:'orange'});\n  }\n}\ngetPages();\n},[])\n\n\n\n///when the current page updates gets the current pages, if the user is writing\n//if there are no pages in the book then it adds pages, if the user is writing\n//if a user is trying to write on another users book, it redirects them to the page where they can read it instead\nuseEffect(()=>{\nconst getPages=async()=>{\n\n  const res = await reqBook('get',`/books/${bookId}`,'book');\n\n  if(!areReading && res.data.username===currentUser.username){\n    const res = await reqPages('get',`/books/${bookId}/pages`,'pages',{page_nums:currPage},false);\n    if(res.message==='Page not found!'){\n      addPages();\n    }else {\n      setPages((n)=>n=[...res])\n    }\n\n  }\n  else if (!areReading && res.data.username !== currentUser.username) {\nnavigate(`/book/${bookId}`);\n//set message to: Unautrized! Only the writer of the book can edit the book.\n  }\n}\n\ngetPages();\n\n\n},[currPage])\n\n\n//go to the next or previous pages\n//save the current pages\nconst changePage =(num,data)=>{\nif(!areReading) updatePage(data);\nlet newPage = currPage[0]!==null? currPage[0]+num : num;\nif (newPage<=0) newPage = 1;\nif(newPage>=pages.length && areReading) newPage =pages.length-1;\nsetCurrPage((n)=>n=[newPage,newPage+1]);\n}\n\n//gose to a page\nconst goToPage=(num)=>{\nsetCurrPage((n)=>n=[num,num+1]);\n}\n\n\n\n//add new Pages\nconst addPages =async()=>{\nconst res = await reqPages('post',`/books/${bookId}/pages`,'pages',{num_of_pages:2,page_num:currPage[0]});\n}\n\n//saves/updates the current pages\nconst updatePage =async(data)=>{\n  if(currPage[0]){\n  const pg1 = await reqPages('patch',`/books/${bookId}/pages/${currPage[0]}`,'page',{text:data.text},false);\n  const pg2 = await reqPages('patch',`/books/${bookId}/pages/${currPage[1]}`,'page',{text:data.text2},false);\n  }\n\n}\n\n\n  return <div className ='Book'>\n  {\n    pages[0] && !areReading?\n     <BookMark  bookId={bookId} username={currentUser.username} currPageId={pages[0].id} changePage={goToPage}/>\n     :null\n  }\n\n   <img className ={areReading? 'Book_cover_Reading' : 'Book_cover'} src={cover} alt=\"cover\"/>\n  <img className ={areReading? 'Book_pages_Reading' : 'Book_pages'} src={page} alt=\"pages\"/>\n\n  {\n     pages.length>0?\n      areReading?\n      <>\n      <Page changePage={changePage} page={[pages[currPage[0]-1],pages[currPage[1]-1]]}/>\n      </>\n      : <>\n      <InputPage changePage={changePage} savePage={updatePage} page={[...pages]}/>\n      </>\n    : null\n  }\n\n\n  </div>\n\n}\n\nexport default Book;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}